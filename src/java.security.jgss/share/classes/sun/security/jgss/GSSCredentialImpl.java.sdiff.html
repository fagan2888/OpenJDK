<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="cache-control" content="no-cache"></meta>
<meta http-equiv="Content-Type" content="text/xhtml;charset=utf-8"></meta>
<meta http-equiv="Pragma" content="no-cache"></meta>
<meta http-equiv="Expires" content="-1"></meta>
<!--
   Note to customizers: the body of the webrev is IDed as SUNWwebrev
   to allow easy overriding by users of webrev via the userContent.css
   mechanism available in some browsers.

   For example, to have all "removed" information be red instead of
   brown, set a rule in your userContent.css file like:

       body#SUNWwebrev span.removed { color: red ! important; }
-->
<style type="text/css" media="screen">
body {
    background-color: #eeeeee;
}
hr {
    border: none 0;
    border-top: 1px solid #aaa;
    height: 1px;
}
div.summary {
    font-size: .8em;
    border-bottom: 1px solid #aaa;
    padding-left: 1em;
    padding-right: 1em;
}
div.summary h2 {
    margin-bottom: 0.3em;
}
div.summary table th {
    text-align: right;
    vertical-align: top;
    white-space: nowrap;
}
span.lineschanged {
    font-size: 0.7em;
}
span.oldmarker {
    color: red;
    font-size: large;
    font-weight: bold;
}
span.newmarker {
    color: green;
    font-size: large;
    font-weight: bold;
}
span.removed {
    color: brown;
}
span.changed {
    color: blue;
}
span.new {
    color: blue;
    font-weight: bold;
}
span.chmod {
    font-size: 0.7em;
    color: #db7800;
}
a.print { font-size: x-small; }
a:hover { background-color: #ffcc99; }
</style>

<style type="text/css" media="print">
pre { font-size: 0.8em; font-family: courier, monospace; }
span.removed { color: #444; font-style: italic }
span.changed { font-weight: bold; }
span.new { font-weight: bold; }
span.newmarker { font-size: 1.2em; font-weight: bold; }
span.oldmarker { font-size: 1.2em; font-weight: bold; }
a.print {display: none}
hr { border: none 0; border-top: 1px solid #aaa; height: 1px; }
</style>

<title>ws Sdiff src/java.security.jgss/share/classes/sun/security/jgss/GSSCredentialImpl.java</title>
</head><body id="SUNWwebrev">
<a class="print" href="javascript:print()">Print this page</a>
<pre>Add JGSS JNI bindings for gss cred store functions
Add createCredential() with password
Also avoid memory allocation in newGSSOIDSet() renamed to makeGSSOIDset()
which now takes a singleton set argument and either assigns the requested
OID or with SPNEGO returns a static list of all the supported mechs. With
this we no longer need deleteGSSOIDSet().</pre>

<table><tr valign="top">
<td><pre>

</pre><hr></hr><pre>
  54     // Used by new ExtendedGSSCredential.ExtendedGSSCredentialImpl(cred)
  55     protected GSSCredentialImpl(GSSCredentialImpl src) {
  56         this.gssManager = src.gssManager;
  57         this.destroyed = src.destroyed;
  58         this.hashtable = src.hashtable;
  59         this.tempCred = src.tempCred;
  60     }
  61 
  62     GSSCredentialImpl(GSSManagerImpl gssManager, int usage)
  63         throws GSSException {
  64         this(gssManager, null, GSSCredential.DEFAULT_LIFETIME,
  65              (Oid[]) null, usage);
  66     }
  67 
  68     GSSCredentialImpl(GSSManagerImpl gssManager, GSSName name,
  69                              int lifetime, Oid mech, int usage)
  70         throws GSSException {
  71         if (mech == null) mech = ProviderList.DEFAULT_MECH_OID;
  72 
  73         init(gssManager);
<span class="changed">  74         add(name, lifetime, lifetime, mech, usage);</span>




















  75     }
  76 
  77     GSSCredentialImpl(GSSManagerImpl gssManager, GSSName name,
  78                       int lifetime, Oid[] mechs, int usage)
  79         throws GSSException {







  80         init(gssManager);
  81         boolean defaultList = false;
  82         if (mechs == null) {
  83             mechs = gssManager.getMechs();
  84             defaultList = true;
  85         }
  86 
  87         for (int i = 0; i &lt; mechs.length; i++) {
  88             try {
<span class="changed">  89                 add(name, lifetime, lifetime, mechs[i], usage);</span>


























  90             } catch (GSSException e) {
  91                 if (defaultList) {
  92                     // Try the next mechanism
  93                     GSSUtil.debug("Ignore " + e + " while acquring cred for "
  94                         + mechs[i]);
  95                     //e.printStackTrace();
  96                 } else throw e; // else try the next mechanism
  97             }
  98         }
  99         if ((hashtable.size() == 0) || (usage != getUsage()))
 100             throw new GSSException(GSSException.NO_CRED);
 101     }
 102 
 103     // Wrap a mech cred into a GSS cred
 104     public GSSCredentialImpl(GSSManagerImpl gssManager,
 105                       GSSCredentialSpi mechElement) throws GSSException {
 106 
 107         init(gssManager);
 108         int usage = GSSCredential.ACCEPT_ONLY;
 109         if (mechElement.isInitiatorCredential()) {

</pre><hr></hr><pre>
 400     }
 401 
 402     public Oid[] getMechs() throws GSSException {
 403 
 404         if (destroyed) {
 405             throw new IllegalStateException("This credential is " +
 406                                         "no longer valid");
 407         }
 408         Vector&lt;Oid&gt; result = new Vector&lt;Oid&gt;(hashtable.size());
 409 
 410         for (Enumeration&lt;SearchKey&gt; e = hashtable.keys();
 411                                                 e.hasMoreElements(); ) {
 412             SearchKey tempKey = e.nextElement();
 413             result.addElement(tempKey.getMech());
 414         }
 415         return result.toArray(new Oid[0]);
 416     }
 417 
 418     public void add(GSSName name, int initLifetime, int acceptLifetime,
 419                     Oid mech, int usage) throws GSSException {





















 420 
 421         if (destroyed) {
 422             throw new IllegalStateException("This credential is " +
 423                                         "no longer valid");
 424         }
 425         if (mech == null) mech = ProviderList.DEFAULT_MECH_OID;
 426 
 427         SearchKey key = new SearchKey(mech, usage);
 428         if (hashtable.containsKey(key)) {
 429             throw new GSSExceptionImpl(GSSException.DUPLICATE_ELEMENT,
 430                                        "Duplicate element found: " +
 431                                        getElementStr(mech, usage));
 432         }
 433 
 434         // XXX If not instance of GSSNameImpl then throw exception
 435         // Application mixing GSS implementations
 436         GSSNameSpi nameElement = (name == null ? null :
 437                                   ((GSSNameImpl)name).getElement(mech));
 438 







 439         tempCred = gssManager.getCredentialElement(nameElement,

 440                                                    initLifetime,
 441                                                    acceptLifetime,
 442                                                    mech,
 443                                                    usage);








 444         /*
 445          * Not all mechanisms support the concept of one credential element
 446          * that can be used for both initiating and accepting a context. In
 447          * the event that an application requests usage INITIATE_AND_ACCEPT
 448          * for a credential from such a mechanism, the GSS framework will
 449          * need to obtain two different credential elements from the
 450          * mechanism, one that will have usage INITIATE_ONLY and another
 451          * that will have usage ACCEPT_ONLY. The mechanism will help the
 452          * GSS-API realize this by returning a credential element with
 453          * usage INITIATE_ONLY or ACCEPT_ONLY prompting it to make another
 454          * call to getCredentialElement, this time with the other usage
 455          * mode.
 456          */
 457 
 458         if (tempCred != null) {
 459             if (usage == GSSCredential.INITIATE_AND_ACCEPT &amp;&amp;
 460                 (!tempCred.isAcceptorCredential() ||
 461                 !tempCred.isInitiatorCredential())) {
 462 
 463                 int currentUsage;
 464                 int desiredUsage;
 465 
 466                 if (!tempCred.isInitiatorCredential()) {
 467                     currentUsage = GSSCredential.ACCEPT_ONLY;
 468                     desiredUsage = GSSCredential.INITIATE_ONLY;
 469                 } else {
 470                     currentUsage = GSSCredential.INITIATE_ONLY;
 471                     desiredUsage = GSSCredential.ACCEPT_ONLY;
 472                 }
 473 
 474                 key = new SearchKey(mech, currentUsage);
 475                 hashtable.put(key, tempCred);
 476 














 477                 tempCred = gssManager.getCredentialElement(nameElement,

 478                                                         initLifetime,
 479                                                         acceptLifetime,
 480                                                         mech,
 481                                                         desiredUsage);

 482 
 483                 key = new SearchKey(mech, desiredUsage);
 484                 hashtable.put(key, tempCred);
 485             } else {
 486                 hashtable.put(key, tempCred);
 487             }
 488         }
 489     }
 490 
 491     public boolean equals(Object another) {
 492 
 493         if (destroyed) {
 494             throw new IllegalStateException("This credential is " +
 495                                         "no longer valid");
 496         }
 497 
 498         if (this == another) {
 499             return true;
 500         }
 501 

</pre><hr></hr><pre>
 622             GSSCredentialSpi o = values.nextElement();
 623             retVal.add(o);
 624         }
 625         return retVal;
 626     }
 627 
 628     private static String getElementStr(Oid mechOid, int usage) {
 629         String displayString = mechOid.toString();
 630         if (usage == GSSCredential.INITIATE_ONLY) {
 631             displayString =
 632                 displayString.concat(" usage: Initiate");
 633         } else if (usage == GSSCredential.ACCEPT_ONLY) {
 634             displayString =
 635                 displayString.concat(" usage: Accept");
 636         } else {
 637             displayString =
 638                 displayString.concat(" usage: Initiate and Accept");
 639         }
 640         return displayString;
 641     }

























 642 
 643     public String toString() {
 644 
 645         if (destroyed) {
 646             throw new IllegalStateException("This credential is " +
 647                                         "no longer valid");
 648         }
 649 
 650         GSSCredentialSpi element = null;
 651         StringBuilder sb = new StringBuilder("[GSSCredential: ");
 652         Object[] elements = hashtable.entrySet().toArray();
 653         for (int i = 0; i &lt; elements.length; i++) {
 654             try {
 655                 sb.append('\n');
 656                 element = (GSSCredentialSpi)
 657                     ((Map.Entry)elements[i]).getValue();
 658                 sb.append(element.getName());
 659                 sb.append(' ');
 660                 sb.append(element.getMechanism());
 661                 sb.append(element.isInitiatorCredential() ?

</pre><hr></hr>
</pre></td><td><pre>

</pre><hr></hr><pre>
  54     // Used by new ExtendedGSSCredential.ExtendedGSSCredentialImpl(cred)
  55     protected GSSCredentialImpl(GSSCredentialImpl src) {
  56         this.gssManager = src.gssManager;
  57         this.destroyed = src.destroyed;
  58         this.hashtable = src.hashtable;
  59         this.tempCred = src.tempCred;
  60     }
  61 
  62     GSSCredentialImpl(GSSManagerImpl gssManager, int usage)
  63         throws GSSException {
  64         this(gssManager, null, GSSCredential.DEFAULT_LIFETIME,
  65              (Oid[]) null, usage);
  66     }
  67 
  68     GSSCredentialImpl(GSSManagerImpl gssManager, GSSName name,
  69                       int lifetime, Oid mech, int usage)
  70         throws GSSException {
  71         if (mech == null) mech = ProviderList.DEFAULT_MECH_OID;
  72 
  73         init(gssManager);
<span class="changed">  74         String password = null;</span>
<span class="changed">  75         add(name, password, lifetime, lifetime, mech, usage);</span>
<span class="changed">  76     }</span>
<span class="changed">  77 </span>
<span class="changed">  78     GSSCredentialImpl(GSSManagerImpl gssManager, GSSName name,</span>
<span class="changed">  79                       Map&lt;String,String&gt; store, int lifetime, Oid mech,</span>
<span class="changed">  80                       int usage)</span>
<span class="changed">  81         throws GSSException {</span>
<span class="changed">  82         if (mech == null) mech = ProviderList.DEFAULT_MECH_OID;</span>
<span class="changed">  83 </span>
<span class="changed">  84         init(gssManager);</span>
<span class="changed">  85         add(name, store, lifetime, lifetime, mech, usage);</span>
<span class="changed">  86     }</span>
<span class="changed">  87 </span>
<span class="changed">  88     GSSCredentialImpl(GSSManagerImpl gssManager, GSSName name, String password,</span>
<span class="changed">  89                       int lifetime, Oid mech, int usage)</span>
<span class="changed">  90         throws GSSException {</span>
<span class="changed">  91         if (mech == null) mech = ProviderList.DEFAULT_MECH_OID;</span>
<span class="changed">  92 </span>
<span class="changed">  93         init(gssManager);</span>
<span class="changed">  94         add(name, password, lifetime, lifetime, mech, usage);</span>
  95     }
  96 
  97     GSSCredentialImpl(GSSManagerImpl gssManager, GSSName name,
  98                       int lifetime, Oid[] mechs, int usage)
  99         throws GSSException {
<span class="new"> 100         this(gssManager, name, (String)null, lifetime, mechs, usage);</span>
<span class="new"> 101     }</span>
<span class="new"> 102 </span>
<span class="new"> 103     GSSCredentialImpl(GSSManagerImpl gssManager, GSSName name,</span>
<span class="new"> 104                       Map&lt;String,String&gt; store, int lifetime,</span>
<span class="new"> 105                       Oid mechs[], int usage)</span>
<span class="new"> 106         throws GSSException {</span>
 107         init(gssManager);
 108         boolean defaultList = false;
 109         if (mechs == null) {
 110             mechs = gssManager.getMechs();
 111             defaultList = true;
 112         }
 113 
 114         for (int i = 0; i &lt; mechs.length; i++) {
 115             try {
<span class="changed"> 116                 add(name, store, lifetime, lifetime, mechs[i], usage);</span>
<span class="changed"> 117             } catch (GSSException e) {</span>
<span class="changed"> 118                 if (defaultList) {</span>
<span class="changed"> 119                     // Try the next mechanism</span>
<span class="changed"> 120                     GSSUtil.debug("Ignore " + e + " while acquring cred for "</span>
<span class="changed"> 121                         + mechs[i]);</span>
<span class="changed"> 122                     //e.printStackTrace();</span>
<span class="changed"> 123                 } else throw e; // else try the next mechanism</span>
<span class="changed"> 124             }</span>
<span class="changed"> 125         }</span>
<span class="changed"> 126         if ((hashtable.size() == 0) || (usage != getUsage()))</span>
<span class="changed"> 127             throw new GSSException(GSSException.NO_CRED);</span>
<span class="changed"> 128     }</span>
<span class="changed"> 129 </span>
<span class="changed"> 130     GSSCredentialImpl(GSSManagerImpl gssManager, GSSName name,</span>
<span class="changed"> 131                       String password, int lifetime, Oid mechs[], int usage)</span>
<span class="changed"> 132         throws GSSException {</span>
<span class="changed"> 133         init(gssManager);</span>
<span class="changed"> 134         boolean defaultList = false;</span>
<span class="changed"> 135         if (mechs == null) {</span>
<span class="changed"> 136             mechs = gssManager.getMechs();</span>
<span class="changed"> 137             defaultList = true;</span>
<span class="changed"> 138         }</span>
<span class="changed"> 139 </span>
<span class="changed"> 140         for (int i = 0; i &lt; mechs.length; i++) {</span>
<span class="changed"> 141             try {</span>
<span class="changed"> 142                 add(name, password, lifetime, lifetime, mechs[i], usage);</span>
 143             } catch (GSSException e) {
 144                 if (defaultList) {
 145                     // Try the next mechanism
 146                     GSSUtil.debug("Ignore " + e + " while acquring cred for "
 147                         + mechs[i]);
 148                     //e.printStackTrace();
 149                 } else throw e; // else try the next mechanism
 150             }
 151         }
 152         if ((hashtable.size() == 0) || (usage != getUsage()))
 153             throw new GSSException(GSSException.NO_CRED);
 154     }
 155 
 156     // Wrap a mech cred into a GSS cred
 157     public GSSCredentialImpl(GSSManagerImpl gssManager,
 158                       GSSCredentialSpi mechElement) throws GSSException {
 159 
 160         init(gssManager);
 161         int usage = GSSCredential.ACCEPT_ONLY;
 162         if (mechElement.isInitiatorCredential()) {

</pre><hr></hr><pre>
 453     }
 454 
 455     public Oid[] getMechs() throws GSSException {
 456 
 457         if (destroyed) {
 458             throw new IllegalStateException("This credential is " +
 459                                         "no longer valid");
 460         }
 461         Vector&lt;Oid&gt; result = new Vector&lt;Oid&gt;(hashtable.size());
 462 
 463         for (Enumeration&lt;SearchKey&gt; e = hashtable.keys();
 464                                                 e.hasMoreElements(); ) {
 465             SearchKey tempKey = e.nextElement();
 466             result.addElement(tempKey.getMech());
 467         }
 468         return result.toArray(new Oid[0]);
 469     }
 470 
 471     public void add(GSSName name, int initLifetime, int acceptLifetime,
 472                     Oid mech, int usage) throws GSSException {
<span class="new"> 473         String password = null;</span>
<span class="new"> 474         add(name, password, initLifetime, acceptLifetime, mech, usage);</span>
<span class="new"> 475     }</span>
<span class="new"> 476 </span>
<span class="new"> 477     public void add(GSSName name, Map&lt;String,String&gt; store, int initLifetime,</span>
<span class="new"> 478                     int acceptLifetime, Oid mech, int usage)</span>
<span class="new"> 479                     throws GSSException {</span>
<span class="new"> 480         add(name, (String)null, store, initLifetime, acceptLifetime,</span>
<span class="new"> 481             mech, usage);</span>
<span class="new"> 482     }</span>
<span class="new"> 483 </span>
<span class="new"> 484     public void add(GSSName name, String password, int initLifetime,</span>
<span class="new"> 485                     int acceptLifetime, Oid mech, int usage)</span>
<span class="new"> 486                     throws GSSException {</span>
<span class="new"> 487         add(name, password, (Map&lt;String,String&gt;)null, initLifetime,</span>
<span class="new"> 488             acceptLifetime, mech, usage);</span>
<span class="new"> 489     }</span>
<span class="new"> 490 </span>
<span class="new"> 491     private void add(GSSName name, String password, Map&lt;String,String&gt; store,</span>
<span class="new"> 492                     int initLifetime, int acceptLifetime, Oid mech, int usage)</span>
<span class="new"> 493                     throws GSSException {</span>
 494 
 495         if (destroyed) {
 496             throw new IllegalStateException("This credential is " +
 497                                         "no longer valid");
 498         }
 499         if (mech == null) mech = ProviderList.DEFAULT_MECH_OID;
 500 
 501         SearchKey key = new SearchKey(mech, usage);
 502         if (hashtable.containsKey(key)) {
 503             throw new GSSExceptionImpl(GSSException.DUPLICATE_ELEMENT,
 504                                        "Duplicate element found: " +
 505                                        getElementStr(mech, usage));
 506         }
 507 
 508         // XXX If not instance of GSSNameImpl then throw exception
 509         // Application mixing GSS implementations
 510         GSSNameSpi nameElement = (name == null ? null :
 511                                   ((GSSNameImpl)name).getElement(mech));
 512 
<span class="new"> 513         if (password == null &amp;&amp; store == null) {</span>
<span class="new"> 514             tempCred = gssManager.getCredentialElement(nameElement,</span>
<span class="new"> 515                                                        initLifetime,</span>
<span class="new"> 516                                                        acceptLifetime,</span>
<span class="new"> 517                                                        mech,</span>
<span class="new"> 518                                                        usage);</span>
<span class="new"> 519         } else if (password != null) {</span>
 520             tempCred = gssManager.getCredentialElement(nameElement,
<span class="new"> 521                                                        password,</span>
 522                                                        initLifetime,
 523                                                        acceptLifetime,
 524                                                        mech,
 525                                                        usage);
<span class="new"> 526         } else {</span>
<span class="new"> 527             tempCred = gssManager.getCredentialElement(nameElement,</span>
<span class="new"> 528                                                        store,</span>
<span class="new"> 529                                                        initLifetime,</span>
<span class="new"> 530                                                        acceptLifetime,</span>
<span class="new"> 531                                                        mech,</span>
<span class="new"> 532                                                        usage);</span>
<span class="new"> 533         }</span>
 534         /*
 535          * Not all mechanisms support the concept of one credential element
 536          * that can be used for both initiating and accepting a context. In
 537          * the event that an application requests usage INITIATE_AND_ACCEPT
 538          * for a credential from such a mechanism, the GSS framework will
 539          * need to obtain two different credential elements from the
 540          * mechanism, one that will have usage INITIATE_ONLY and another
 541          * that will have usage ACCEPT_ONLY. The mechanism will help the
 542          * GSS-API realize this by returning a credential element with
 543          * usage INITIATE_ONLY or ACCEPT_ONLY prompting it to make another
 544          * call to getCredentialElement, this time with the other usage
 545          * mode.
 546          */
 547 
 548         if (tempCred != null) {
 549             if (usage == GSSCredential.INITIATE_AND_ACCEPT &amp;&amp;
 550                 (!tempCred.isAcceptorCredential() ||
 551                 !tempCred.isInitiatorCredential())) {
 552 
 553                 int currentUsage;
 554                 int desiredUsage;
 555 
 556                 if (!tempCred.isInitiatorCredential()) {
 557                     currentUsage = GSSCredential.ACCEPT_ONLY;
 558                     desiredUsage = GSSCredential.INITIATE_ONLY;
 559                 } else {
 560                     currentUsage = GSSCredential.INITIATE_ONLY;
 561                     desiredUsage = GSSCredential.ACCEPT_ONLY;
 562                 }
 563 
 564                 key = new SearchKey(mech, currentUsage);
 565                 hashtable.put(key, tempCred);
 566 
<span class="new"> 567                 if (store == null &amp;&amp; password == null) {</span>
<span class="new"> 568                     tempCred = gssManager.getCredentialElement(nameElement,</span>
<span class="new"> 569                                                                initLifetime,</span>
<span class="new"> 570                                                                acceptLifetime,</span>
<span class="new"> 571                                                                mech,</span>
<span class="new"> 572                                                                desiredUsage);</span>
<span class="new"> 573                 } else if (password != null) {</span>
<span class="new"> 574                     tempCred = gssManager.getCredentialElement(nameElement,</span>
<span class="new"> 575                                                                password,</span>
<span class="new"> 576                                                                initLifetime,</span>
<span class="new"> 577                                                                acceptLifetime,</span>
<span class="new"> 578                                                                mech,</span>
<span class="new"> 579                                                                desiredUsage);</span>
<span class="new"> 580                 } else {</span>
 581                     tempCred = gssManager.getCredentialElement(nameElement,
<span class="new"> 582                                                                store,</span>
 583                                                                initLifetime,
 584                                                                acceptLifetime,
 585                                                                mech,
 586                                                                desiredUsage);
<span class="new"> 587                 }</span>
 588 
 589                 key = new SearchKey(mech, desiredUsage);
 590                 hashtable.put(key, tempCred);
 591             } else {
 592                 hashtable.put(key, tempCred);
 593             }
 594         }
 595     }
 596 
 597     public boolean equals(Object another) {
 598 
 599         if (destroyed) {
 600             throw new IllegalStateException("This credential is " +
 601                                         "no longer valid");
 602         }
 603 
 604         if (this == another) {
 605             return true;
 606         }
 607 

</pre><hr></hr><pre>
 728             GSSCredentialSpi o = values.nextElement();
 729             retVal.add(o);
 730         }
 731         return retVal;
 732     }
 733 
 734     private static String getElementStr(Oid mechOid, int usage) {
 735         String displayString = mechOid.toString();
 736         if (usage == GSSCredential.INITIATE_ONLY) {
 737             displayString =
 738                 displayString.concat(" usage: Initiate");
 739         } else if (usage == GSSCredential.ACCEPT_ONLY) {
 740             displayString =
 741                 displayString.concat(" usage: Accept");
 742         } else {
 743             displayString =
 744                 displayString.concat(" usage: Initiate and Accept");
 745         }
 746         return displayString;
 747     }
<span class="new"> 748 </span>
<span class="new"> 749     public void storeInto(int usage, Oid mech,</span>
<span class="new"> 750                           boolean overwrite, boolean defaultCred,</span>
<span class="new"> 751                           Map&lt;String,String&gt; store) throws GSSException {</span>
<span class="new"> 752         if (destroyed) {</span>
<span class="new"> 753             throw new IllegalStateException("This credential is " +</span>
<span class="new"> 754                                             "no longer valid");</span>
<span class="new"> 755         }</span>
<span class="new"> 756 </span>
<span class="new"> 757         SearchKey key = null;</span>
<span class="new"> 758         GSSCredentialSpi element = null;</span>
<span class="new"> 759 </span>
<span class="new"> 760         if (mech == null) {</span>
<span class="new"> 761             mech = ProviderList.DEFAULT_MECH_OID;</span>
<span class="new"> 762         }</span>
<span class="new"> 763 </span>
<span class="new"> 764         key = new SearchKey(mech, usage);</span>
<span class="new"> 765         element = hashtable.get(key);</span>
<span class="new"> 766         if (element == null) {</span>
<span class="new"> 767             throw new GSSExceptionImpl(GSSException.BAD_MECH, mech);</span>
<span class="new"> 768         }</span>
<span class="new"> 769 </span>
<span class="new"> 770         element.storeInto(usage, overwrite, defaultCred, store);</span>
<span class="new"> 771     }</span>
<span class="new"> 772 </span>
 773 
 774     public String toString() {
 775 
 776         if (destroyed) {
 777             throw new IllegalStateException("This credential is " +
 778                                         "no longer valid");
 779         }
 780 
 781         GSSCredentialSpi element = null;
 782         StringBuilder sb = new StringBuilder("[GSSCredential: ");
 783         Object[] elements = hashtable.entrySet().toArray();
 784         for (int i = 0; i &lt; elements.length; i++) {
 785             try {
 786                 sb.append('\n');
 787                 element = (GSSCredentialSpi)
 788                     ((Map.Entry)elements[i]).getValue();
 789                 sb.append(element.getName());
 790                 sb.append(' ');
 791                 sb.append(element.getMechanism());
 792                 sb.append(element.isInitiatorCredential() ?

</pre><hr></hr>
</pre></td>
</tr></table>
</body></html>
