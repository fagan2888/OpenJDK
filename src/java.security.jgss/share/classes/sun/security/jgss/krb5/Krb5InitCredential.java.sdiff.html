<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="cache-control" content="no-cache"></meta>
<meta http-equiv="Content-Type" content="text/xhtml;charset=utf-8"></meta>
<meta http-equiv="Pragma" content="no-cache"></meta>
<meta http-equiv="Expires" content="-1"></meta>
<!--
   Note to customizers: the body of the webrev is IDed as SUNWwebrev
   to allow easy overriding by users of webrev via the userContent.css
   mechanism available in some browsers.

   For example, to have all "removed" information be red instead of
   brown, set a rule in your userContent.css file like:

       body#SUNWwebrev span.removed { color: red ! important; }
-->
<style type="text/css" media="screen">
body {
    background-color: #eeeeee;
}
hr {
    border: none 0;
    border-top: 1px solid #aaa;
    height: 1px;
}
div.summary {
    font-size: .8em;
    border-bottom: 1px solid #aaa;
    padding-left: 1em;
    padding-right: 1em;
}
div.summary h2 {
    margin-bottom: 0.3em;
}
div.summary table th {
    text-align: right;
    vertical-align: top;
    white-space: nowrap;
}
span.lineschanged {
    font-size: 0.7em;
}
span.oldmarker {
    color: red;
    font-size: large;
    font-weight: bold;
}
span.newmarker {
    color: green;
    font-size: large;
    font-weight: bold;
}
span.removed {
    color: brown;
}
span.changed {
    color: blue;
}
span.new {
    color: blue;
    font-weight: bold;
}
span.chmod {
    font-size: 0.7em;
    color: #db7800;
}
a.print { font-size: x-small; }
a:hover { background-color: #ffcc99; }
</style>

<style type="text/css" media="print">
pre { font-size: 0.8em; font-family: courier, monospace; }
span.removed { color: #444; font-style: italic }
span.changed { font-weight: bold; }
span.new { font-weight: bold; }
span.newmarker { font-size: 1.2em; font-weight: bold; }
span.oldmarker { font-size: 1.2em; font-weight: bold; }
a.print {display: none}
hr { border: none 0; border-top: 1px solid #aaa; height: 1px; }
</style>

<title>ws Sdiff src/java.security.jgss/share/classes/sun/security/jgss/krb5/Krb5InitCredential.java</title>
</head><body id="SUNWwebrev">
<a class="print" href="javascript:print()">Print this page</a>
<pre>Add isDefaultCredential() method to GSSCredentialSpi</pre>

<table><tr valign="top">
<td><pre>

</pre><hr></hr><pre>
  39 import java.security.PrivilegedExceptionAction;
  40 import java.security.PrivilegedActionException;
  41 
  42 /**
  43  * Implements the krb5 initiator credential element.
  44  *
  45  * @author Mayank Upadhyay
  46  * @author Ram Marti
  47  * @since 1.4
  48  */
  49 
  50 public class Krb5InitCredential
  51     extends KerberosTicket
  52     implements Krb5CredElement {
  53 
  54     private static final long serialVersionUID = 7723415700837898232L;
  55 
  56     private Krb5NameElement name;
  57     private Credentials krb5Credentials;
  58     public KerberosTicket proxyTicket;

  59 
  60     private Krb5InitCredential(Krb5NameElement name,
  61                                byte[] asn1Encoding,
  62                                KerberosPrincipal client,
  63                                KerberosPrincipal clientAlias,
  64                                KerberosPrincipal server,
  65                                KerberosPrincipal serverAlias,
  66                                byte[] sessionKey,
  67                                int keyType,
  68                                boolean[] flags,
  69                                Date authTime,
  70                                Date startTime,
  71                                Date endTime,
  72                                Date renewTill,
  73                                InetAddress[] clientAddresses)
  74                                throws GSSException {
  75         super(asn1Encoding,
  76               client,
  77               server,
  78               sessionKey,
  79               keyType,
  80               flags,
  81               authTime,
  82               startTime,
  83               endTime,
  84               renewTill,
  85               clientAddresses);
  86         KerberosSecrets.getJavaxSecurityAuthKerberosAccess()
  87                 .kerberosTicketSetClientAlias(this, clientAlias);
  88         KerberosSecrets.getJavaxSecurityAuthKerberosAccess()
  89                 .kerberosTicketSetServerAlias(this, serverAlias);
  90         this.name = name;


  91 
  92         try {
  93             // Cache this for later use by the sun.security.krb5 package.
  94             krb5Credentials = new Credentials(asn1Encoding,
  95                                               client.getName(),
  96                                               (clientAlias != null ?
  97                                                       clientAlias.getName() : null),
  98                                               server.getName(),
  99                                               (serverAlias != null ?
 100                                                       serverAlias.getName() : null),
 101                                               sessionKey,
 102                                               keyType,
 103                                               flags,
 104                                               authTime,
 105                                               startTime,
 106                                               endTime,
 107                                               renewTill,
 108                                               clientAddresses);
 109         } catch (KrbException e) {
 110             throw new GSSException(GSSException.NO_CRED, -1,

</pre><hr></hr><pre>
 132                                Date renewTill,
 133                                InetAddress[] clientAddresses)
 134                                throws GSSException {
 135         super(asn1Encoding,
 136               client,
 137               server,
 138               sessionKey,
 139               keyType,
 140               flags,
 141               authTime,
 142               startTime,
 143               endTime,
 144               renewTill,
 145               clientAddresses);
 146         KerberosSecrets.getJavaxSecurityAuthKerberosAccess()
 147                 .kerberosTicketSetClientAlias(this, clientAlias);
 148         KerberosSecrets.getJavaxSecurityAuthKerberosAccess()
 149                 .kerberosTicketSetServerAlias(this, serverAlias);
 150         this.name = name;
 151         // A delegated cred does not have all fields set. So do not try to
<span class="changed"> 152         // creat new Credentials out of the delegatedCred.</span>

 153         this.krb5Credentials = delegatedCred;
 154     }
 155 
 156     static Krb5InitCredential getInstance(GSSCaller caller, Krb5NameElement name,
 157                                    int initLifetime)
 158         throws GSSException {
 159 
 160         KerberosTicket tgt = getTgt(caller, name, initLifetime);
 161         if (tgt == null)
 162             throw new GSSException(GSSException.NO_CRED, -1,
 163                                    "Failed to find any Kerberos tgt");
 164 
 165         if (name == null) {
 166             String fullName = tgt.getClient().getName();
 167             name = Krb5NameElement.getInstance(fullName,
 168                                        Krb5MechFactory.NT_GSS_KRB5_PRINCIPAL);
 169         }
 170 
 171         KerberosPrincipal clientAlias = KerberosSecrets
 172                 .getJavaxSecurityAuthKerberosAccess()

</pre><hr></hr><pre>
 292         return 0;
 293     }
 294 
 295     public boolean isInitiatorCredential() throws GSSException {
 296         return true;
 297     }
 298 
 299     public boolean isAcceptorCredential() throws GSSException {
 300         return false;
 301     }
 302 
 303     /**
 304      * Returns the oid representing the underlying credential
 305      * mechanism oid.
 306      *
 307      * @return the Oid for this credential mechanism
 308      * @exception GSSException may be thrown
 309      */
 310     public final Oid getMechanism() {
 311         return Krb5MechFactory.GSS_KRB5_MECH_OID;









 312     }
 313 
 314     public final java.security.Provider getProvider() {
 315         return Krb5MechFactory.PROVIDER;
 316     }
 317 
 318 
 319     /**
 320      * Returns a sun.security.krb5.Credentials instance so that it maybe
 321      * used in that package for th Kerberos protocol.
 322      */
 323     Credentials getKrb5Credentials() {
 324         return krb5Credentials;
 325     }
 326 
 327     /*
 328      * XXX Call to this.refresh() should refresh the locally cached copy
 329      * of krb5Credentials also.
 330      */
 331 

</pre><hr></hr>
</pre></td><td><pre>

</pre><hr></hr><pre>
  39 import java.security.PrivilegedExceptionAction;
  40 import java.security.PrivilegedActionException;
  41 
  42 /**
  43  * Implements the krb5 initiator credential element.
  44  *
  45  * @author Mayank Upadhyay
  46  * @author Ram Marti
  47  * @since 1.4
  48  */
  49 
  50 public class Krb5InitCredential
  51     extends KerberosTicket
  52     implements Krb5CredElement {
  53 
  54     private static final long serialVersionUID = 7723415700837898232L;
  55 
  56     private Krb5NameElement name;
  57     private Credentials krb5Credentials;
  58     public KerberosTicket proxyTicket;
<span class="new">  59     private boolean isDefCred;</span>
  60 
  61     private Krb5InitCredential(Krb5NameElement name,
  62                                byte[] asn1Encoding,
  63                                KerberosPrincipal client,
  64                                KerberosPrincipal clientAlias,
  65                                KerberosPrincipal server,
  66                                KerberosPrincipal serverAlias,
  67                                byte[] sessionKey,
  68                                int keyType,
  69                                boolean[] flags,
  70                                Date authTime,
  71                                Date startTime,
  72                                Date endTime,
  73                                Date renewTill,
  74                                InetAddress[] clientAddresses)
  75                                throws GSSException {
  76         super(asn1Encoding,
  77               client,
  78               server,
  79               sessionKey,
  80               keyType,
  81               flags,
  82               authTime,
  83               startTime,
  84               endTime,
  85               renewTill,
  86               clientAddresses);
  87         KerberosSecrets.getJavaxSecurityAuthKerberosAccess()
  88                 .kerberosTicketSetClientAlias(this, clientAlias);
  89         KerberosSecrets.getJavaxSecurityAuthKerberosAccess()
  90                 .kerberosTicketSetServerAlias(this, serverAlias);
  91         this.name = name;
<span class="new">  92         if (name == null)</span>
<span class="new">  93             isDefCred = true;</span>
  94 
  95         try {
  96             // Cache this for later use by the sun.security.krb5 package.
  97             krb5Credentials = new Credentials(asn1Encoding,
  98                                               client.getName(),
  99                                               (clientAlias != null ?
 100                                                       clientAlias.getName() : null),
 101                                               server.getName(),
 102                                               (serverAlias != null ?
 103                                                       serverAlias.getName() : null),
 104                                               sessionKey,
 105                                               keyType,
 106                                               flags,
 107                                               authTime,
 108                                               startTime,
 109                                               endTime,
 110                                               renewTill,
 111                                               clientAddresses);
 112         } catch (KrbException e) {
 113             throw new GSSException(GSSException.NO_CRED, -1,

</pre><hr></hr><pre>
 135                                Date renewTill,
 136                                InetAddress[] clientAddresses)
 137                                throws GSSException {
 138         super(asn1Encoding,
 139               client,
 140               server,
 141               sessionKey,
 142               keyType,
 143               flags,
 144               authTime,
 145               startTime,
 146               endTime,
 147               renewTill,
 148               clientAddresses);
 149         KerberosSecrets.getJavaxSecurityAuthKerberosAccess()
 150                 .kerberosTicketSetClientAlias(this, clientAlias);
 151         KerberosSecrets.getJavaxSecurityAuthKerberosAccess()
 152                 .kerberosTicketSetServerAlias(this, serverAlias);
 153         this.name = name;
 154         // A delegated cred does not have all fields set. So do not try to
<span class="changed"> 155         // creat new Credentials out of the delegatedCred.  Also, a delegated</span>
<span class="changed"> 156         // credential is not a default credential.</span>
 157         this.krb5Credentials = delegatedCred;
 158     }
 159 
 160     static Krb5InitCredential getInstance(GSSCaller caller, Krb5NameElement name,
 161                                    int initLifetime)
 162         throws GSSException {
 163 
 164         KerberosTicket tgt = getTgt(caller, name, initLifetime);
 165         if (tgt == null)
 166             throw new GSSException(GSSException.NO_CRED, -1,
 167                                    "Failed to find any Kerberos tgt");
 168 
 169         if (name == null) {
 170             String fullName = tgt.getClient().getName();
 171             name = Krb5NameElement.getInstance(fullName,
 172                                        Krb5MechFactory.NT_GSS_KRB5_PRINCIPAL);
 173         }
 174 
 175         KerberosPrincipal clientAlias = KerberosSecrets
 176                 .getJavaxSecurityAuthKerberosAccess()

</pre><hr></hr><pre>
 296         return 0;
 297     }
 298 
 299     public boolean isInitiatorCredential() throws GSSException {
 300         return true;
 301     }
 302 
 303     public boolean isAcceptorCredential() throws GSSException {
 304         return false;
 305     }
 306 
 307     /**
 308      * Returns the oid representing the underlying credential
 309      * mechanism oid.
 310      *
 311      * @return the Oid for this credential mechanism
 312      * @exception GSSException may be thrown
 313      */
 314     public final Oid getMechanism() {
 315         return Krb5MechFactory.GSS_KRB5_MECH_OID;
<span class="new"> 316     }</span>
<span class="new"> 317 </span>
<span class="new"> 318     /**</span>
<span class="new"> 319      * Returns true if the credential is a default credential.</span>
<span class="new"> 320      *</span>
<span class="new"> 321      * @return true if the credential is a default credential, else false.</span>
<span class="new"> 322      */</span>
<span class="new"> 323     public boolean isDefaultCredential() {</span>
<span class="new"> 324         return isDefCred;</span>
 325     }
 326 
 327     public final java.security.Provider getProvider() {
 328         return Krb5MechFactory.PROVIDER;
 329     }
 330 
 331 
 332     /**
 333      * Returns a sun.security.krb5.Credentials instance so that it maybe
 334      * used in that package for th Kerberos protocol.
 335      */
 336     Credentials getKrb5Credentials() {
 337         return krb5Credentials;
 338     }
 339 
 340     /*
 341      * XXX Call to this.refresh() should refresh the locally cached copy
 342      * of krb5Credentials also.
 343      */
 344 

</pre><hr></hr>
</pre></td>
</tr></table>
</body></html>
