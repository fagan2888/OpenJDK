<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="cache-control" content="no-cache"></meta>
<meta http-equiv="Content-Type" content="text/xhtml;charset=utf-8"></meta>
<meta http-equiv="Pragma" content="no-cache"></meta>
<meta http-equiv="Expires" content="-1"></meta>
<!--
   Note to customizers: the body of the webrev is IDed as SUNWwebrev
   to allow easy overriding by users of webrev via the userContent.css
   mechanism available in some browsers.

   For example, to have all "removed" information be red instead of
   brown, set a rule in your userContent.css file like:

       body#SUNWwebrev span.removed { color: red ! important; }
-->
<style type="text/css" media="screen">
body {
    background-color: #eeeeee;
}
hr {
    border: none 0;
    border-top: 1px solid #aaa;
    height: 1px;
}
div.summary {
    font-size: .8em;
    border-bottom: 1px solid #aaa;
    padding-left: 1em;
    padding-right: 1em;
}
div.summary h2 {
    margin-bottom: 0.3em;
}
div.summary table th {
    text-align: right;
    vertical-align: top;
    white-space: nowrap;
}
span.lineschanged {
    font-size: 0.7em;
}
span.oldmarker {
    color: red;
    font-size: large;
    font-weight: bold;
}
span.newmarker {
    color: green;
    font-size: large;
    font-weight: bold;
}
span.removed {
    color: brown;
}
span.changed {
    color: blue;
}
span.new {
    color: blue;
    font-weight: bold;
}
span.chmod {
    font-size: 0.7em;
    color: #db7800;
}
a.print { font-size: x-small; }
a:hover { background-color: #ffcc99; }
</style>

<style type="text/css" media="print">
pre { font-size: 0.8em; font-family: courier, monospace; }
span.removed { color: #444; font-style: italic }
span.changed { font-weight: bold; }
span.new { font-weight: bold; }
span.newmarker { font-size: 1.2em; font-weight: bold; }
span.oldmarker { font-size: 1.2em; font-weight: bold; }
a.print {display: none}
hr { border: none 0; border-top: 1px solid #aaa; height: 1px; }
</style>

<title>ws Sdiff src/java.security.jgss/share/classes/sun/security/jgss/krb5/Krb5AcceptCredential.java</title>
</head><body id="SUNWwebrev">
<a class="print" href="javascript:print()">Print this page</a>
<pre>Add isDefaultCredential() method to GSSCredentialSpi</pre>

<table><tr valign="top">
<td><pre>

</pre><hr></hr><pre>
  30 import sun.security.jgss.GSSCaller;
  31 import sun.security.jgss.spi.*;
  32 import sun.security.krb5.*;
  33 import java.security.PrivilegedActionException;
  34 import java.security.PrivilegedExceptionAction;
  35 import java.security.AccessController;
  36 import java.security.AccessControlContext;
  37 import javax.security.auth.DestroyFailedException;
  38 
  39 /**
  40  * Implements the krb5 acceptor credential element.
  41  *
  42  * @author Mayank Upadhyay
  43  * @since 1.4
  44  */
  45 public class Krb5AcceptCredential
  46     implements Krb5CredElement {
  47 
  48     private final Krb5NameElement name;
  49     private final ServiceCreds screds;

  50 
  51     private Krb5AcceptCredential(Krb5NameElement name, ServiceCreds creds) {
  52         /*
  53          * Initialize this instance with the data from the acquired
  54          * KerberosKey. This class needs to be a KerberosKey too
  55          * hence we can't just store a reference.
  56          */
  57 
  58         this.name = name;
  59         this.screds = creds;


  60     }
  61 
  62     static Krb5AcceptCredential getInstance(final GSSCaller caller, Krb5NameElement name)
  63         throws GSSException {
  64 
  65         final String serverPrinc = (name == null? null:
  66             name.getKrb5PrincipalName().getName());
  67         final AccessControlContext acc = AccessController.getContext();
  68 
  69         ServiceCreds creds = null;
  70         try {
  71             creds = AccessController.doPrivileged(
  72                         new PrivilegedExceptionAction&lt;ServiceCreds&gt;() {
  73                 public ServiceCreds run() throws Exception {
  74                     return Krb5Util.getServiceCreds(
  75                         caller == GSSCaller.CALLER_UNKNOWN ? GSSCaller.CALLER_ACCEPT: caller,
  76                         serverPrinc, acc);
  77                 }});
  78         } catch (PrivilegedActionException e) {
  79             GSSException ge =

</pre><hr></hr><pre>
 129         return GSSCredential.INDEFINITE_LIFETIME;
 130     }
 131 
 132     public boolean isInitiatorCredential() throws GSSException {
 133         return false;
 134     }
 135 
 136     public boolean isAcceptorCredential() throws GSSException {
 137         return true;
 138     }
 139 
 140     /**
 141      * Returns the oid representing the underlying credential
 142      * mechanism oid.
 143      *
 144      * @return the Oid for this credential mechanism
 145      * @exception GSSException may be thrown
 146      */
 147     public final Oid getMechanism() {
 148         return Krb5MechFactory.GSS_KRB5_MECH_OID;









 149     }
 150 
 151     public final java.security.Provider getProvider() {
 152         return Krb5MechFactory.PROVIDER;
 153     }
 154 
 155     public EncryptionKey[] getKrb5EncryptionKeys(PrincipalName princ) {
 156         return screds.getEKeys(princ);
 157     }
 158 
 159     /**
 160      * Called to invalidate this credential element.
 161      */
 162     public void dispose() throws GSSException {
 163         try {
 164             destroy();
 165         } catch (DestroyFailedException e) {
 166             GSSException gssException =
 167                 new GSSException(GSSException.FAILURE, -1,
 168                  "Could not destroy credentials - " + e.getMessage());

</pre><hr></hr>
</pre></td><td><pre>

</pre><hr></hr><pre>
  30 import sun.security.jgss.GSSCaller;
  31 import sun.security.jgss.spi.*;
  32 import sun.security.krb5.*;
  33 import java.security.PrivilegedActionException;
  34 import java.security.PrivilegedExceptionAction;
  35 import java.security.AccessController;
  36 import java.security.AccessControlContext;
  37 import javax.security.auth.DestroyFailedException;
  38 
  39 /**
  40  * Implements the krb5 acceptor credential element.
  41  *
  42  * @author Mayank Upadhyay
  43  * @since 1.4
  44  */
  45 public class Krb5AcceptCredential
  46     implements Krb5CredElement {
  47 
  48     private final Krb5NameElement name;
  49     private final ServiceCreds screds;
<span class="new">  50     private boolean isDefCred = false;</span>
  51 
  52     private Krb5AcceptCredential(Krb5NameElement name, ServiceCreds creds) {
  53         /*
  54          * Initialize this instance with the data from the acquired
  55          * KerberosKey. This class needs to be a KerberosKey too
  56          * hence we can't just store a reference.
  57          */
  58 
  59         this.name = name;
  60         this.screds = creds;
<span class="new">  61         if (name == null)</span>
<span class="new">  62             isDefCred = true;</span>
  63     }
  64 
  65     static Krb5AcceptCredential getInstance(final GSSCaller caller, Krb5NameElement name)
  66         throws GSSException {
  67 
  68         final String serverPrinc = (name == null? null:
  69             name.getKrb5PrincipalName().getName());
  70         final AccessControlContext acc = AccessController.getContext();
  71 
  72         ServiceCreds creds = null;
  73         try {
  74             creds = AccessController.doPrivileged(
  75                         new PrivilegedExceptionAction&lt;ServiceCreds&gt;() {
  76                 public ServiceCreds run() throws Exception {
  77                     return Krb5Util.getServiceCreds(
  78                         caller == GSSCaller.CALLER_UNKNOWN ? GSSCaller.CALLER_ACCEPT: caller,
  79                         serverPrinc, acc);
  80                 }});
  81         } catch (PrivilegedActionException e) {
  82             GSSException ge =

</pre><hr></hr><pre>
 132         return GSSCredential.INDEFINITE_LIFETIME;
 133     }
 134 
 135     public boolean isInitiatorCredential() throws GSSException {
 136         return false;
 137     }
 138 
 139     public boolean isAcceptorCredential() throws GSSException {
 140         return true;
 141     }
 142 
 143     /**
 144      * Returns the oid representing the underlying credential
 145      * mechanism oid.
 146      *
 147      * @return the Oid for this credential mechanism
 148      * @exception GSSException may be thrown
 149      */
 150     public final Oid getMechanism() {
 151         return Krb5MechFactory.GSS_KRB5_MECH_OID;
<span class="new"> 152     }</span>
<span class="new"> 153 </span>
<span class="new"> 154     /**</span>
<span class="new"> 155      * Returns true if the credential is a default credential.</span>
<span class="new"> 156      *</span>
<span class="new"> 157      * @return true if the credential is a default credential, else false.</span>
<span class="new"> 158      */</span>
<span class="new"> 159     public boolean isDefaultCredential() {</span>
<span class="new"> 160         return isDefCred;</span>
 161     }
 162 
 163     public final java.security.Provider getProvider() {
 164         return Krb5MechFactory.PROVIDER;
 165     }
 166 
 167     public EncryptionKey[] getKrb5EncryptionKeys(PrincipalName princ) {
 168         return screds.getEKeys(princ);
 169     }
 170 
 171     /**
 172      * Called to invalidate this credential element.
 173      */
 174     public void dispose() throws GSSException {
 175         try {
 176             destroy();
 177         } catch (DestroyFailedException e) {
 178             GSSException gssException =
 179                 new GSSException(GSSException.FAILURE, -1,
 180                  "Could not destroy credentials - " + e.getMessage());

</pre><hr></hr>
</pre></td>
</tr></table>
</body></html>
